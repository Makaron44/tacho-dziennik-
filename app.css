:root{ --bg:#111318; --card:#161922; --ink:#e9eef6; --muted:#9aa4b2; --accent:#4ee3b5; }
*{ box-sizing:border-box; }
html,body{ margin:0; padding:0; background:var(--bg); color:var(--ink); font-family: system-ui, Segoe UI, Roboto, Arial, sans-serif; }
.top{ position:sticky; top:0; z-index:10; display:flex; justify-content:space-between; align-items:center; padding:12px 14px; background:rgba(0,0,0,.55); backdrop-filter:saturate(1.2) blur(8px); border-bottom:1px solid rgba(255,255,255,.06); }
.brand{ font-weight:900; letter-spacing:.3px; }
.tabs button{ margin-left:8px; background:transparent; color:var(--ink); border:1px solid rgba(255,255,255,.15); padding:6px 10px; border-radius:10px; }
.tabs button.active{ background:var(--accent); color:#000; border-color:transparent; font-weight:800; }
main{ padding:14px; }
h1{ font-size:20px; margin:14px 2px; }
.muted{ color:var(--muted); }
.card{ background:var(--card); border:1px solid rgba(255,255,255,.06); border-radius:14px; padding:12px; margin:12px 2px; }
.row{ display:flex; gap:10px; margin:6px 2px; }
button{ background:#2b3040; color:var(--ink); border:1px solid rgba(255,255,255,.12); border-radius:10px; padding:8px 12px; }
button.danger{ background:#ff6b6b; color:#000; border:0; }
input[type="text"]{ width:100%; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,.12); background:#0f1217; color:var(--ink); margin:0 0 8px; }
.mono{ font-family: ui-monospace, SFMono-Regular, Menlo, monospace; white-space:pre-wrap; }
.view{ display:none; } .view.show{ display:block; }

/* Upewnij się, że pasek DUO nie przykrywa UI u dołu */
body{ padding-bottom:110px; }
/* === iPhone pack (safe-area / ergonomia / gęstość) === */
:root{
  --safe-t: env(safe-area-inset-top);
  --safe-b: env(safe-area-inset-bottom);
  --safe-l: env(safe-area-inset-left);
  --safe-r: env(safe-area-inset-right);
}

/* 1) Top bar z uwzględnieniem notcha */
.top{
  padding-top: max(10px, var(--safe-t));
}

/* 2) Typografia skaluje się do szerokości */
html{ font-size: clamp(15px, 2.6vw, 17px); }
h1{ font-size: clamp(18px, 4.6vw, 22px); }

/* 3) Trafianie palcem: min. 44px */
button, .tabs button{
  min-height: 44px;
  padding: 10px 12px;
  -webkit-tap-highlight-color: transparent;
}
input, select, textarea{ font-size: 16px; } /* brak auto-zoomu na iOS */

/* 4) Karty/odstępy ciaśniej na wąskim ekranie */
@media (max-width: 430px){
  main{ padding: 10px; }
  .card{ margin: 10px 2px; padding: 10px; border-radius: 12px; }
  .row{ gap: 8px; }
}

/* 5) Tacho bar – bezpieczny dystans od „home” i krawędzi */
#tachoBar.duo.v4{
  left: calc(12px + var(--safe-l)) !important;
  right: calc(12px + var(--safe-r)) !important;
  bottom: calc(16px + var(--safe-b)) !important;
}
#tachoFab{
  right: calc(12px + var(--safe-r)) !important;
  bottom: calc(16px + var(--safe-b)) !important;
}

/* 6) Zapas miejsca pod paskiem (by nic nie było zakryte) */
body{ padding-bottom: calc(120px + var(--safe-b)) !important; }

/* 7) Układ statystyk A/B – jedna kolumna na wąsko */
@media (max-width: 430px){
  #tachoBar.duo.v4 .stats{ grid-template-columns: 1fr; }
}

/* 8) „Oddychający” log – wysokość i momentum scroll */
#tachoBar.duo.v4 .tlog{ max-height: 38vh; -webkit-overflow-scrolling: touch; }

/* 9) Mniejsze marginesy w górnym pasku przycisków paska */
#tachoBar.duo.v4 .tduo-inner{ gap: 6px; }
#tachoBar.duo.v4 .trow{ gap: 6px; flex-wrap: wrap; }
#tachoBar.duo.v4 .trow.top button{ padding: 8px 10px; }

/* 10) Subtelny cień pigułek/przycisków dla czytelności na OLED */
#tachoBar.duo.v4, #tachoFab{ box-shadow: 0 12px 28px rgba(0,0,0,.35); }
/* ========== Neo-glass UI dla Tacho DUO ========== */
:root{
  --card:#161a22;
  --ink:#e9eef6;
  --muted:#9aa4b2;
  --ok:#4ee3b5;
  --warn:#ffd65c;
  --bad:#ff6b6b;
  --surf: rgba(255,255,255,.06);
  --surf-2: rgba(255,255,255,.10);
}

/* Przyciski – gładkie, responsywne, ładny „press” */
#tachoBar.duo.v4 button{
  background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
  color: var(--ink);
  border: 1px solid var(--surf);
  border-radius: 14px;
  padding: 10px 12px;
  backdrop-filter: saturate(1.1) blur(6px);
  box-shadow: 0 6px 18px rgba(0,0,0,.25);
  transition: transform .07s ease, box-shadow .18s ease, background .2s ease, border-color .2s ease;
}
#tachoBar.duo.v4 button:hover{ background: rgba(255,255,255,.14); }
#tachoBar.duo.v4 button:active{ transform: translateY(1px) scale(.98); }
#tachoBar.duo.v4 .aswitch{ background: var(--ok); color:#000; border-color: transparent; font-weight:900; }
#tachoBar.duo.v4 .parking9{ background:#6cc8ff; color:#000; border-color: transparent; font-weight:900; }
#tachoBar.duo.v4 .dreset{ background: var(--bad); color:#000; border:0; font-weight:900; }
#tachoBar.duo.v4 .restReset{ background: var(--warn); color:#000; border:0; font-weight:900; }
#tachoBar.duo.v4 .vplay.on{ background: var(--ok); color:#000; border-color: transparent; font-weight:900; }

/* Tryby – aktywny kolor + „uniesienie” (już masz klasę .active) */
#tachoBar.duo.v4 .modes .chips button{ min-width: 92px; }
#tachoBar.duo.v4 .modes .chips button.active{
  transform: translateY(-1px);
  box-shadow: 0 8px 22px rgba(0,0,0,.28), 0 0 0 2px rgba(255,255,255,.16) inset;
  font-weight:900;
}
#tachoBar.duo.v4 .modes .chips button[data-m="drive"].active{ background: var(--ok);   color:#000; }
#tachoBar.duo.v4 .modes .chips button[data-m="pause"].active{ background: var(--warn); color:#000; }
#tachoBar.duo.v4 .modes .chips button[data-m="work"].active { background:#a7a6ff; color:#000; }
#tachoBar.duo.v4 .modes .chips button[data-m="rest"].active { background:#6cc8ff; color:#000; }

/* Karty A/B – nowoczesne „glass cards” */
#tachoBar.duo.v4 .stats{
  width:100%;
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:12px;
}
@media (max-width:430px){
  #tachoBar.duo.v4 .stats{ grid-template-columns: 1fr; }
}
#tachoBar.duo.v4 .col{
  position: relative;
  background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
  border: 1px solid var(--surf);
  border-radius: 16px;
  padding: 12px;
  box-shadow: 0 10px 26px rgba(0,0,0,.30);
}
#tachoBar.duo.v4 .col.active{ outline: 2px solid var(--ok); }
#tachoBar.duo.v4 .col.prewarn{ box-shadow: 0 0 0 2px rgba(255,214,92,.35) inset; }
#tachoBar.duo.v4 .col.warn-stint{ box-shadow: 0 0 0 2px rgba(255,107,107,.35) inset; }
#tachoBar.duo.v4 .col .hdr{
  display:inline-flex; align-items:center; gap:8px;
  font-weight:900; letter-spacing:.4px; margin-bottom:8px;
}
#tachoBar.duo.v4 .col .hdr::after{
  content: attr(data-mode);
  text-transform: uppercase;
  font-size: 11px;
  padding: 3px 7px;
  border-radius: 999px;
  background: rgba(255,255,255,.12);
  color: var(--muted);
}
/* header chip koloru wg trybu */
#tachoBar.duo.v4 .col[data-mode="drive"] .hdr::after{ background: var(--ok); color:#000; }
#tachoBar.duo.v4 .col[data-mode="pause"] .hdr::after{ background: var(--warn); color:#000; }
#tachoBar.duo.v4 .col[data-mode="rest"]  .hdr::after{ background: #6cc8ff; color:#000; }

/* Linie z etykietą+wartością + cienkie metry postępu */
#tachoBar.duo.v4 .line{ position: relative; display:flex; justify-content:space-between; gap:10px; padding:6px 2px 10px; }
#tachoBar.duo.v4 .line .lbl{ color: var(--muted); font-weight:700; letter-spacing:.3px; }
#tachoBar.duo.v4 .line .val{ font-weight:900; }
#tachoBar.duo.v4 .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, monospace; }

/* wspólne tło paska */
#tachoBar.duo.v4 .line::after{
  content:""; position:absolute; left:0; bottom:2px; height:6px;
  width: 0; border-radius: 999px; background: linear-gradient(90deg, rgba(255,255,255,.18), rgba(255,255,255,.04));
}
/* konkretne metry – sterowane zmiennymi z JS */
#tachoBar.duo.v4 .stint::after{ width: var(--p-stint); background: linear-gradient(90deg, var(--ok), rgba(78,227,181,.2)); }
#tachoBar.duo.v4 .brk::after  { width: var(--p-break); background: linear-gradient(90deg, var(--warn), rgba(255,214,92,.2)); }
#tachoBar.duo.v4 .day::after  { width: var(--p-day);   background: linear-gradient(90deg, #8ac5ff, rgba(138,197,255,.2)); }
#tachoBar.duo.v4 .w30::after  { width: var(--p-30h);   background: linear-gradient(90deg, #b79cff, rgba(183,156,255,.2)); }

/* Sekcja „Przerwa aktywnego” – ciasny rządek pigułek */
#tachoBar.duo.v4 .presets .chips button{ min-width:58px; font-weight:800; }
#tachoBar.duo.v4 .trow.top, #tachoBar.duo.v4 .trow{ gap: 8px; flex-wrap: wrap; }
#tachoBar.gps-on   .gpsToggle{ background:#4ee3b5; color:#000; border-color:transparent; font-weight:900; }
#tachoBar.gps-pending .gpsToggle{ background:#ffd65c; color:#000; border-color:transparent; font-weight:900; }
#tachoBar .line { position: relative; overflow: hidden; }
#tachoBar .line .lbl { opacity:.8 }
#tachoBar .line .val { font-variant-numeric: tabular-nums; }
#tachoBar .col { --bar: rgba(78,227,181,.14); }
#tachoBar .col .line.rest9::before{
  content:"";
  position:absolute; left:0; top:calc(100% - 3px); height:3px;
  width: var(--p-rest9, 0%); background: var(--bar);
  border-radius: 3px;
}
/* PLAN DNIA */
.card.plan { display:grid; gap:12px; }
.plan-head{ display:flex; align-items:center; gap:12px; }
.plan-head .plan-stats{ font-weight:600 }
.plan-head .plan-actions{ margin-left:auto; display:flex; gap:8px; }

.plan-form{ display:grid; gap:8px; }
.plan-form .chips{ display:flex; gap:8px; flex-wrap:wrap; }

.plan-timeline{ display:grid; gap:8px; }
.plan-timeline .tl{
  position:relative; height:36px; border:1px solid rgba(255,255,255,.08);
  border-radius:12px; overflow:hidden; background:rgba(255,255,255,.03);
}
.plan-timeline .tl .block{
  position:absolute; top:6px; height:24px; border-radius:8px;
  display:flex; align-items:center; justify-content:center;
  font-size:12px; padding:0 8px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}
.plan-timeline .tl .now{
  position:absolute; top:0; bottom:0; width:2px; background:#4ee3b5; opacity:.9;
}
.plan-timeline .hours{ display:flex; justify-content:space-between; font-size:12px; opacity:.6; padding:0 4px; }

.plan-list{ display:grid; gap:8px; }
.seg-item{
  display:grid; grid-template-columns: 1fr auto; gap:8px; align-items:center;
  border:1px solid rgba(255,255,255,.08); border-radius:12px; padding:10px;
  background:rgba(255,255,255,.02);
}
.seg-item .meta{ font-size:14px; opacity:.9 }
.seg-item .actions{ display:flex; gap:6px; flex-wrap:wrap; }
.seg-item .tag{ font-weight:700; padding:2px 8px; border-radius:999px; font-size:12px; }
.tag.drive{ background:#2ecc71; color:#001b0d }
.tag.pause{ background:#f1c40f; color:#1e1a00 }
.tag.work { background:#7aa2ff; color:#00122b }
.tag.rest { background:#4ee3b5; color:#001b15 }

.btn-ghost-sm{ background:transparent; border:1px dashed rgba(255,255,255,.2); padding:6px 10px; border-radius:10px; font-size:13px; }
.btn-danger{ background:#ff6b6b; color:#000; border:0; padding:6px 10px; border-radius:10px; }

.plan-timeline .block.drive{ background:rgba(46,204,113,.85); color:#001b0d }
.plan-timeline .block.pause{ background:rgba(241,196,15,.9); color:#1e1a00 }
.plan-timeline .block.work { background:rgba(122,162,255,.9); color:#00122b }
.plan-timeline .block.rest { background:rgba(78,227,181,.9); color:#001b15 }
/* --- FIX: Plan Dzienny – responsywność i brak „rozjazdu” --- */
.card.plan { max-width: 100%; }

.plan-timeline { overflow: hidden; }
.plan-timeline .tl { width: 100%; position: relative; }
.plan-timeline .hours{
  display: grid;
  grid-template-columns: repeat(13, 1fr); /* 0..24 co 2h */
  gap: 0;
  width: 100%;
}
.plan-timeline .hours span{
  text-align: center;
  white-space: nowrap;
  font-variant-numeric: tabular-nums;
}

/* Nie pozwól elementom z listy wypychać karty */
.plan-list, .seg-item { max-width: 100%; }
.seg-item .actions { flex-wrap: wrap; justify-content: flex-end; }

/* iPhone – unikamy auto-zoom i „przesuwania” pól */
.plan-form input, .plan-form select, .plan-form button { font-size: 16px; }

/* Węższe ekrany: pokazuj co 4 godziny i trochę mniejsza czcionka */
@media (max-width: 420px){
  .plan-timeline .hours span{ font-size: 11px; }
  /* schowaj co drugą etykietę (zostaną: 00, 04, 08, 12, 16, 20, 24) */
  .plan-timeline .hours span:nth-child(odd){ display: none; }
  .plan-timeline .tl{ height: 30px; }
}

/* Jeszcze węższe (np. bardzo małe okna) – tylko 00, 12, 24 */
@media (max-width: 350px){
  .plan-timeline .hours span{ display: none; }
  .plan-timeline .hours span:nth-child(1),
  .plan-timeline .hours span:nth-child(7),
  .plan-timeline .hours span:nth-child(13){ display: block; }
}
/* === PLAN: poziome przewijanie + warstwy === */
:root { --hourW: 56px; }               /* szerokość 1 godziny na osi */
.card.plan { max-width: 100%; }

/* Oś w poziomym scrollu */
.plan-timeline{
  position: relative;
  overflow-x: auto;                     /* przewijanie w poziomie */
  overflow-y: visible;
  -webkit-overflow-scrolling: touch;
  padding-bottom: 6px;                  /* żeby nie ocierało o krawędź */
}
.plan-timeline .tl,
.plan-timeline .hours{
  min-width: calc(var(--hourW) * 24);   /* 24h = 24 * szerokość godziny */
}
.plan-timeline .tl{
  position: relative;
  height: 36px;
  border:1px solid rgba(255,255,255,.08);
  border-radius:12px;
  overflow:hidden;
  background:rgba(255,255,255,.03);
}
.plan-timeline .tl .block{
  position:absolute; top:6px; height:24px; border-radius:8px;
  display:flex; align-items:center; justify-content:center;
  font-size:12px; padding:0 8px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}
.plan-timeline .tl .now{ position:absolute; top:0; bottom:0; width:2px; background:#4ee3b5; }

.plan-timeline .hours{
  display:flex; justify-content:space-between;
  font-size:12px; opacity:.65; padding:4px 2px 0;
}

/* WARSTWY: lista ma być nad osią (żeby przyciski były klikalne) */
.plan-timeline { z-index: 1; }
.plan-list    { position: relative; z-index: 2; }

/* Na wąskich ekranach możesz zmniejszyć gęstość osi zmieniając var(--hourW) */
@media (max-width: 420px){
  :root { --hourW: 48px; }
}
@media (max-width: 360px){
  :root { --hourW: 42px; }
}
/* Pokaż wszystkie etykiety co 2h (tak jak rysuje JS) */
.plan-timeline .hours span{ display:inline-block !important; }

/* i na węższych breakpointach też nic nie chowamy */
@media (max-width: 420px){
  .plan-timeline .hours span{ display:inline-block !important; }
}
@media (max-width: 350px){
  .plan-timeline .hours span{ display:inline-block !important; }
}
/* --- Notatki: formularz + lista --- */
#quick .note-form { display: grid; gap: 8px; }
#quick .note-row  { display: grid; gap: 8px; grid-template-columns: 1fr auto; align-items: center; }
#quick .note-actions { display: flex; gap: 8px; }
#quick input, #quick button { font-size: 16px; } /* bez auto-zoomu na iPhone */

.notes-list { display: grid; gap: 8px; margin-top: 6px; }
.note-item{
  display: grid; gap: 6px;
  border: 1px solid rgba(255,255,255,.12);
  background: rgba(255,255,255,.03);
  border-radius: 12px;
  padding: 10px;
}
.note-item .top { display: flex; gap: 8px; align-items: baseline; }
.note-item .text { flex: 1; white-space: pre-wrap; }
.note-item .meta { font-size: 12px; opacity: .7; }
.note-item .row-actions { display: flex; gap: 8px; margin-left: auto; }
.note-item .del {
  background: #ff6b6b; color: #000; border: 0; border-radius: 10px;
  padding: 6px 10px; font-weight: 700;
}
.notes-tools{
  display:flex; gap:8px; margin-top:8px;
  justify-content:flex-end; flex-wrap:wrap;
}
.notes-tools .btn-ghost{
  border:1px solid rgba(255,255,255,.14);
  border-radius:10px; padding:6px 10px;
}
/* przyciski eksportu zawsze klikalne, nad wszystkim */
.notes-tools { position: relative; z-index: 1000; }
.notes-tools, .notes-tools * { pointer-events: auto; }
/* Awaryjny pływający eksport */
#expFab {
  position: fixed; right: 14px; bottom: 14px;
  width: 52px; height: 52px; border-radius: 26px;
  background: #2bd5a7; color:#0b0e12;
  display:flex; align-items:center; justify-content:center;
  font-weight:700; box-shadow:0 6px 24px rgba(0,0,0,.35);
  z-index: 99999; user-select:none; cursor:pointer;
}
#expFab:active { transform: scale(.97); }

#expMenu {
  position: fixed; right: 14px; bottom: 74px;
  background:#1b1f27; border:1px solid rgba(255,255,255,.12);
  border-radius:12px; padding:8px; display:none; z-index: 100000;
  box-shadow:0 12px 30px rgba(0,0,0,.45);
}
#expMenu button{
  display:block; width:160px; margin:4px 0; padding:8px 10px;
  text-align:left; border-radius:10px; border:1px solid rgba(255,255,255,.14);
  background:transparent; color:#e9edf3;
}
#expMenu button:active{ transform:scale(.98); }